%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%参数区%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 用于选定TYPE:
% 其中，0 - 原桁架， 1 - 增添模型1， 2 - 增添模型2， 3 - 增添模型3
TYPE = 3;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%main%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

x = (0:0.01:1.44);
Fs1 = calc(TYPE, 0);
Fs2 = calc(TYPE, 1.44);

showAll(x, Fs1, Fs2);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%函数区%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 获得type下的矩阵
function ret = get_matrix(type)
    sint = 3 / 5;
    cost = 4 / 5;
    sinp = (4-sqrt(3)) / sqrt(28 - 8*sqrt(3));
    cosp = 3 / sqrt(28 - 8*sqrt(3));
    sin30 = 1/2;
    cos30 = sqrt(3)/2;
    switch type
        case 0
            ret = [
                1	-1/2	sinp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	sqrt(3)/2	cosp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	1/2	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	sqrt(3)/2	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	sinp	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	cosp	1	0	0	-sint	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	cost	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	1	sint	0	0	-1	-sint	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	cost	0	1	0	cost	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	sint	1	0	0	-sint	-1	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	-1	0	0	sint	1	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	1	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1
                ];
        case 1
            ret = [
                1	-sin30	sinp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	cosp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	sin30	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	sinp	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	cosp	1	0	0	-sint	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	1	sint	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	1	0	0	-sint	-1	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	1	0	0	-sint	-1	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	-sint	-1	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	1	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1
            ];
        case 2
            ret = [
                1	-sin30	sinp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	cosp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	sin30	0	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	0	0	0	-1	-sint	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	sinp	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	cosp	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	1	0	0	0	-1	-sint	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	sint	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	1	0	0	0	-1	-sint	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	sint	1	0	0	0	-1	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	cost	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1	-sint	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	sint	1	0	0	0	-1	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	1	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	sint	1	0	0	0	-1
            ];
        case 3
            ret = [
                1	-sin30	sinp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	cosp	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	sin30	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	cos30	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	sinp	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	cosp	1	0	0	-sint	-1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	cost	0	1	0	cost	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	1	sint	0	0	-1	-sint	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	1	0	0	0	-1	0	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	cost	0	1	0	cost	0	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	sint	1	0	0	-sint	-1	0	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	cost	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	1	sint	0	0	-1	-sint	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1	0	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1	0	0	0	-1	0	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	cost	0	1	0	1	0;
                0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	sint	1	0	0	0	-1
            ];
    end
end

% 计算在不同type、Q下，各个杆的受力，单位为P
function ret = calc(type, Q)
    b = [0; -1; -1; 0; 0; 0; Q; 0; 0; 0; Q; 0; 0; 0; Q-2; 0; 0; 0; Q; 0; 0; 0; Q; 0];
    A = get_matrix(type);
    ret = A\b;
end

% 展示所有杆子受力情况图
function showAll(x, Fs1, Fs2)
    figure;
    hold on;
    for i = 1: 24
        y = -((Fs2(i) - Fs1(i)) .* x ./ 1.44 + Fs1(i)); % 修正为向内取正（只考虑受压力的最大值）
        plot(x, y);
    end
    legend("杆" + (1:24));
    xlabel("Q(/P)");
    ylabel("F(/P)");
    hold off;
    ret = 1;
end